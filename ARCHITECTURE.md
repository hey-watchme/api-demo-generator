# Demo Data Generator - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ

## ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EventBridge Scheduler (30åˆ†cron: 0/30 * * * ? *)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Lambda: watchme-demo-data-generator-trigger                â”‚
â”‚ - è¤‡æ•°ãƒšãƒ«ã‚½ãƒŠã‚’é †æ¬¡å‡¦ç†                                     â”‚
â”‚ - APIå‘¼ã³å‡ºã—ã®ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ HTTP POST /generate
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FastAPI: demo-generator (EC2/Docker)                       â”‚
â”‚                                                             â”‚
â”‚ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:                                              â”‚
â”‚ â”œâ”€ GET  /personas      ãƒšãƒ«ã‚½ãƒŠä¸€è¦§                        â”‚
â”‚ â””â”€ POST /generate      ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ                           â”‚
â”‚                                                             â”‚
â”‚ ãƒšãƒ«ã‚½ãƒŠç®¡ç†:                                                â”‚
â”‚ â”œâ”€ child_5yo     (5æ­³ç”·å…ã€å¹¼ç¨šåœ’)                         â”‚
â”‚ â”œâ”€ adult_30s     (30ä»£ä¼šç¤¾å“¡ã€IT)                          â”‚
â”‚ â””â”€ elderly_70s   (70ä»£å¥³æ€§ã€é€€è·)                          â”‚
â”‚                                                             â”‚
â”‚ æ©Ÿèƒ½:                                                        â”‚
â”‚ â”œâ”€ æ™‚åˆ»ã«å¿œã˜ãŸå‹•çš„ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ                                â”‚
â”‚ â”œâ”€ ãƒšãƒ«ã‚½ãƒŠåˆ¥ã®è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³                                  â”‚
â”‚ â””â”€ ç´¯ç©vibe_scoresã®è¨ˆç®—                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ Supabase REST API
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Supabase: dashboard_summary ãƒ†ãƒ¼ãƒ–ãƒ«                       â”‚
â”‚                                                             â”‚
â”‚ Primary Key: (device_id, date)                             â”‚
â”‚                                                             â”‚
â”‚ ãƒ‡ãƒã‚¤ã‚¹ID:                                                  â”‚
â”‚ â”œâ”€ demo-child-5yo-001                                      â”‚
â”‚ â”œâ”€ demo-adult-30s-001                                      â”‚
â”‚ â””â”€ demo-elderly-70s-001                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ¯ è¨­è¨ˆæ€æƒ³

### ãªãœAPIåŒ–ã—ãŸã‹ï¼Ÿ

1. **è¤‡æ•°ãƒšãƒ«ã‚½ãƒŠç®¡ç†**
   - ã‚«ã‚¿ãƒ­ã‚°å½¢å¼ã§è¤‡æ•°ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿
   - å­ä¾›ã€å¤§äººã€é«˜é½¢è€…ãªã©å¤šæ§˜ãªå±æ€§

2. **å‹•çš„ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ**
   - æ™‚åˆ»ã«å¿œã˜ãŸç´¯ç©ãƒ‡ãƒ¼ã‚¿
   - ãƒšãƒ«ã‚½ãƒŠåˆ¥ã®è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³
   - ãƒªã‚¢ãƒ«ãªæ„Ÿæƒ…å¤‰åŒ–ã®å†ç¾

3. **æ‹¡å¼µæ€§**
   - æ–°ã—ã„ãƒšãƒ«ã‚½ãƒŠã®è¿½åŠ ãŒå®¹æ˜“
   - ãƒ­ã‚¸ãƒƒã‚¯ã®è¤‡é›‘åŒ–ã«å¯¾å¿œ
   - æ‰‹å‹•ã§ã®ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã‚‚å¯èƒ½

4. **ä¿å®ˆæ€§**
   - Lambda: ã‚·ãƒ³ãƒ—ãƒ«ãªãƒˆãƒªã‚¬ãƒ¼å½¹
   - API: è¤‡é›‘ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
   - è²¬ä»»ã®åˆ†é›¢

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
/Users/kaya.matsumoto/projects/watchme/
â”œâ”€â”€ api/demo-generator/                 # FastAPI (é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤)
â”‚   â”œâ”€â”€ main.py                         # APIãƒ¡ã‚¤ãƒ³ã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ requirements.txt
â”‚   â”œâ”€â”€ .env.example
â”‚   â”œâ”€â”€ .gitignore
â”‚   â”œâ”€â”€ README.md
â”‚   â””â”€â”€ ARCHITECTURE.md                 # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”‚
â””â”€â”€ server-configs/lambda-functions/
    â””â”€â”€ watchme-demo-data-generator/    # Lambda Trigger
        â”œâ”€â”€ lambda_function.py          # APIã‚’å‘¼ã³å‡ºã™ã ã‘
        â”œâ”€â”€ requirements.txt            # requestsã®ã¿
        â”œâ”€â”€ build.sh
        â”œâ”€â”€ deploy.sh
        â”œâ”€â”€ create-eventbridge-rule.sh
        â””â”€â”€ README.md
```

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 1. å®šæœŸå®Ÿè¡Œï¼ˆ30åˆ†ã”ã¨ï¼‰

```
EventBridge
  â†“
Lambda Handler
  â†“
for persona in ["child_5yo", "adult_30s", "elderly_70s"]:
    â”œâ”€ POST /generate {"persona_id": persona}
    â†“
    API: ç¾åœ¨æ™‚åˆ»ã‚’è¨ˆç®—
    API: ãƒšãƒ«ã‚½ãƒŠã«å¿œã˜ãŸãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
    API: Supabase upsert
    â†“
    æˆåŠŸ/å¤±æ•—ã‚’ãƒ­ã‚°å‡ºåŠ›
```

### 2. æ‰‹å‹•å®Ÿè¡Œï¼ˆé–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆï¼‰

```
curl POST /generate
  â”œâ”€ persona_id: "child_5yo"
  â”œâ”€ date: "2025-10-03" (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
  â””â”€ time_block: "14-30" (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
```

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤æˆ¦ç•¥

### Phase 1: ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™º (ç¾åœ¨)

- API: ãƒ­ãƒ¼ã‚«ãƒ«ã§èµ·å‹• (`python3 main.py`)
- Lambda: ãƒ­ãƒ¼ã‚«ãƒ«APIã‚’å‘¼ã³å‡ºã—

### Phase 2: DockeråŒ–

```dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY main.py .
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8020"]
```

### Phase 3: EC2ãƒ‡ãƒ—ãƒ­ã‚¤

- æ—¢å­˜ã®EC2ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«Docker Composeã§è¿½åŠ 
- nginx reverse proxyè¨­å®š
- `https://api.hey-watch.me/demo-generator`

### Phase 4: æœ¬ç•ªé‹ç”¨

- EventBridge: 30åˆ†cronæœ‰åŠ¹åŒ–
- CloudWatchç›£è¦–
- ã‚¨ãƒ©ãƒ¼é€šçŸ¥ï¼ˆSNSï¼‰

## âœ… å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½ï¼ˆ2025-10-03ï¼‰

### child_5yo ãƒšãƒ«ã‚½ãƒŠ
- **UUID**: `a1b2c3d4-e5f6-4a5b-8c9d-0e1f2a3b4c5d`
- **vibe_scores**: 48ãƒ–ãƒ­ãƒƒã‚¯å…¨ä½“ï¼ˆç¾åœ¨æ™‚åˆ»ä»¥é™ã¯nullï¼‰
  - ç¡çœ æ™‚é–“ï¼ˆ00:00-06:30ï¼‰: -5ã€œ+5
  - æœé£Ÿãƒ”ãƒ¼ã‚¯ï¼ˆ07:00-08:00ï¼‰: +25ã€œ+35
  - æ˜¼é£Ÿãƒ”ãƒ¼ã‚¯ï¼ˆ12:00ï¼‰: +40
  - å¤•é£Ÿãƒ”ãƒ¼ã‚¯ï¼ˆ19:00ï¼‰: +30ã€œ+35
- **burst_events**: å¤‰åŒ–é‡15ä»¥ä¸Šã‚’è‡ªå‹•æ¤œå‡º
- **analysis_result**: ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ç”¨ã®æ§‹é€ ä½“
- **insights**: 1æ—¥ã®ç·æ‹¬æ–‡ã‚’è‡ªå‹•ç”Ÿæˆ

### ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
```json
{
  "vibe_scores": [0, -2, ..., 25, null, null, ...],  // 48è¦ç´ 
  "burst_events": [
    {
      "time": "07:00",
      "event": "æœã®èµ·åºŠãƒ»æº–å‚™ã§æ©Ÿå«ŒãŒä¸Šæ˜‡ã—ãŸ",
      "score_change": 15,
      "from_score": 10,
      "to_score": 25
    }
  ],
  "analysis_result": {
    "raw_response": "ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã®ãŸã‚çœç•¥",
    "processing_error": null,
    "extracted_content": "ãƒ‡ãƒ¢ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆ5æ­³ç”·å…ï¼‰ã®åˆ†æçµæœ"
  }
}
```

## ğŸ“Š ä»Šå¾Œã®æ‹¡å¼µ

### ãƒšãƒ«ã‚½ãƒŠè¿½åŠ 

```python
PERSONAS = {
    # å®Ÿè£…æ¸ˆã¿
    "child_5yo": {...},  # âœ… å®Œäº†

    # æœªå®Ÿè£…
    "adult_30s": {...},
    "elderly_70s": {...},

    # è¿½åŠ äºˆå®š
    "teenager_15yo": {...},      # ä¸­å­¦ç”Ÿ
    "young_adult_25yo": {...},   # è‹¥æ‰‹ç¤¾ä¼šäºº
    "parent_40s": {...},         # å­è‚²ã¦ä¸–ä»£
    "senior_60s": {...},         # ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚·ãƒ‹ã‚¢
}
```

### ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯å¼·åŒ–

- æ›œæ—¥ãƒ»å­£ç¯€ã«ã‚ˆã‚‹å¤‰å‹•
- ã‚ˆã‚Šè©³ç´°ãªãƒšãƒ«ã‚½ãƒŠç‰¹æœ‰ã®è¡Œå‹•ãƒ‘ã‚¿ãƒ¼ãƒ³
- æ„Ÿæƒ…å¤‰åŒ–ã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³å¢—åŠ 
- è¤‡æ•°æ—¥ã«ã‚ãŸã‚‹ãƒ‡ãƒ¼ã‚¿ä¸€æ‹¬ç”Ÿæˆ

### APIæ‹¡å¼µ

- `GET /personas/{persona_id}/history` - éå»ãƒ‡ãƒ¼ã‚¿å–å¾—
- `POST /bulk-generate` - è¤‡æ•°æ—¥åˆ†ä¸€æ‹¬ç”Ÿæˆ
- `DELETE /personas/{persona_id}/data` - ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªã‚¢
- ã‚ˆã‚Šè©³ç´°ãªpromptç”Ÿæˆãƒ­ã‚¸ãƒƒã‚¯

## ğŸ” ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

- Lambda CloudWatch Logs: APIå‘¼ã³å‡ºã—æˆåŠŸ/å¤±æ•—
- API CloudWatch Logs: ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã®è©³ç´°
- Supabase: ãƒ‡ãƒ¼ã‚¿è“„ç©çŠ¶æ³

---

**æœ€çµ‚æ›´æ–°**: 2025-10-03
